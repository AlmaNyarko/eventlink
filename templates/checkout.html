{% extends "layout.html" %}
{% block content %}
<div class="d-flex">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="p-4">
            <!-- Logo -->
            <div class="mb-5">
                <h3 class="sidebar-logo">âœ¨ EventLink</h3>
                <span class="badge bg-{% if session.role == 'organizer' %}primary{% else %}secondary{% endif %}">
                    {{ session.role|upper }}
                </span>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="sidebar-nav">
                <a href="{{ url_for('dashboard') }}" class="nav-link">
                    <i class="bi bi-house-door me-2"></i> Home
                </a>
                <a href="{{ url_for('events_list') }}" class="nav-link">
                    <i class="bi bi-calendar-event me-2"></i> Events
                </a>
                <a href="{{ url_for('my_tickets') }}" class="nav-link">
                    <i class="bi bi-ticket-perforated me-2"></i> My Tickets
                </a>
                {% if session.role == 'organizer' %}
                <a href="{{ url_for('events_list') }}" class="nav-link">
                    <i class="bi bi-calendar-plus me-2"></i> My Events
                </a>
                {% endif %}
                <a href="{{ url_for('profile') }}" class="nav-link">
                    <i class="bi bi-person me-2"></i> Profile
                </a>
                <a href="{{ url_for('settings') }}" class="nav-link">
                    <i class="bi bi-gear me-2"></i> Settings
                </a>
            </nav>
            
            <!-- Logout -->
            <div class="mt-auto pt-5">
                <a href="/logout" class="nav-link text-danger">
                    <i class="bi bi-box-arrow-right me-2"></i> Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="flex-grow-1 p-4" style="background-color: var(--color-bg-main);">
        <!-- Top Navigation Bar -->
        <div class="top-nav mb-4">
            <div>
                <h2 class="page-header mb-0">Checkout</h2>
                <p class="text-muted-custom mb-0">Complete your ticket purchase</p>
            </div>
        </div>

        <div class="row">
            <!-- Order Summary -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Order Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex mb-3">
                            <img src="{{ event.image_url }}" class="rounded me-3" style="width: 80px; height: 80px; object-fit: cover;">
                            <div>
                                <h6 class="fw-bold">{{ event.title }}</h6>
                                <p class="text-muted small mb-1">{{ event.location }}</p>
                                <p class="text-muted small mb-0">{{ event.date_time }}</p>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Ticket Price:</span>
                            <span class="fw-bold">${{ "%.2f"|format(event.price) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Service Fee:</span>
                            <span>${{ "%.2f"|format(event.price * 0.1) }}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="fw-bold">Total:</span>
                            <span class="fw-bold text-primary">${{ "%.2f"|format(event.price * 1.1) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Security Info -->
                <div class="card">
                    <div class="card-body text-center">
                        <i class="bi bi-shield-lock text-success fs-1 mb-3"></i>
                        <h6 class="fw-bold">Secure Payment</h6>
                        <p class="text-muted small mb-0">
                            Your payment information is encrypted and secure. 
                            We do not store your card details.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Payment Form -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Payment Information</h5>
                    </div>
                    <div class="card-body">
                        <form action="{{ url_for('process_payment') }}" method="POST">
                            <input type="hidden" name="event_id" value="{{ event.id }}">
                            
                            <!-- Card Details -->
                            <div class="mb-4">
                                <label class="form-label fw-medium">Card Number</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-credit-card"></i>
                                    </span>
                                    <input type="text" class="form-control" name="card_number" 
                                           placeholder="1234 5678 9012 3456" maxlength="19"
                                           oninput="formatCardNumber(this)">
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Expiry Date</label>
                                    <input type="text" class="form-control" name="expiry_date" 
                                           placeholder="MM/YY" maxlength="5"
                                           oninput="formatExpiry(this)">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">CVV</label>
                                    <input type="text" class="form-control" name="cvv" 
                                           placeholder="123" maxlength="4">
                                </div>
                            </div>
                            
                            <!-- Billing Address -->
                            <div class="mb-4">
                                <label class="form-label fw-medium">Billing Address</label>
                                <input type="text" class="form-control mb-2" placeholder="Full Name">
                                <input type="text" class="form-control mb-2" placeholder="Street Address">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" placeholder="City">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" placeholder="State">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" placeholder="ZIP">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Method -->
                            <div class="mb-4">
                                <label class="form-label fw-medium">Payment Method</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_method" id="credit" checked>
                                    <label class="form-check-label" for="credit">
                                        Credit Card
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_method" id="debit">
                                    <label class="form-check-label" for="debit">
                                        Debit Card
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Terms -->
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> 
                                    and <a href="#" class="text-decoration-none">Privacy Policy</a>
                                </label>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-lock me-2"></i>
                                    Pay ${{ "%.2f"|format(event.price * 1.1) }}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Accepted Cards -->
                <div class="text-center mt-3">
                    <small class="text-muted">We accept:</small>
                    <div class="mt-2">
                        <i class="bi bi-credit-card-fill text-dark fs-3 mx-1"></i>
                        <i class="bi bi-bank2 text-primary fs-3 mx-1"></i>
                        <i class="bi bi-wallet2 text-success fs-3 mx-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Format card number with spaces
function formatCardNumber(input) {
    let value = input.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
    let formattedValue = '';
    
    for (let i = 0; i < value.length; i++) {
        if (i > 0 && i % 4 === 0) {
            formattedValue += ' ';
        }
        formattedValue += value[i];
    }
    
    input.value = formattedValue;
}

// Format expiry date
function formatExpiry(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length >= 2) {
        value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }
    input.value = value;
}
</script>
{% endblock %}